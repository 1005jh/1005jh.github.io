<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.8"/><meta name="description" content="typeorm getMany(), getRawMany()" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="typeorm getMany(), getRawMany() - 개발 블로그" data-gatsby-head="true"/><meta name="twitter:description" content="typeorm getMany(), getRawMany()" data-gatsby-head="true"/><meta name="og:title" content="typeorm getMany(), getRawMany() - 개발 블로그" data-gatsby-head="true"/><meta name="og:type" content="website" data-gatsby-head="true"/><meta name="og:description" content="typeorm getMany(), getRawMany()" data-gatsby-head="true"/><meta name="theme-color" content="hsl(31, 92%, 62%)"/><style data-href="/styles.3d1bdeb67f48788ed6ba.css" data-identity="gatsby-global-css">:after,:before,:root{--color-white:#fff;--color-primary:#5c92ff;--color-secondary:#f7a145;--color-prism-background:#eaeaeb;--color-typographic-base-font:#242933;--color-typographic-link-p-font:#5c92ff;--color-typographic-link-s-font:#f7a145;--color-page-border:#eaeaeb;--color-page-background:#fff;--color-sidebar-border:#eaeaeb;--color-sidebar-border-fade:#fff;--color-contacts-border:#eaeaeb;--color-button-border:#eaeaeb;--color-button-color:#242933;--color-theme-switcher:#3f485a;--color-theme-switcher-hover:#5c92ff}.dark :after,.dark :before,:root.dark{--color-white:#fff;--color-primary:#5c92ff;--color-secondary:#f7a145;--color-prism-background:#191d24;--color-typographic-base-font:#fff;--color-typographic-link-p-font:#5c92ff;--color-typographic-link-s-font:#f7a145;--color-page-border:#3f485a;--color-page-background:#242933;--color-sidebar-border:#3f485a;--color-sidebar-border-fade:#242933;--color-contacts-border:#3f485a;--color-button-border:#3f485a;--color-button-color:#fff;--color-theme-switcher:#eaeaeb;--color-theme-switcher-hover:#5c92ff}html{font-size:100}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--color-page-background);color:var(--color-typographic-base-font);font-size:16px;line-height:1.625;margin:0 0 0 calc(100vw - 100%);text-rendering:optimizelegibility}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:40px;line-height:52px;margin-bottom:26px;margin-top:104px}h2{font-size:27px;line-height:39px}h2,h3{margin-bottom:13px;margin-top:52px}h3{font-size:22px;line-height:26px}h4{font-size:19.2px;margin-top:39px}h4,h5{line-height:26px;margin-bottom:13px}h5,h6{font-size:16px;margin-top:65px}h6{line-height:26px;margin-bottom:13px}img{max-width:100%}hr,img{border:0;display:block}hr{background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#242933 0,#242933 15px,transparent 0,transparent 26px);background-size:100% 26px;color:var(--color-typographic-base-font);height:26px;margin:52px auto;width:100px}a{color:var(--color-typographic-link-p-font);text-decoration:none}a:active,a:focus,a:hover{color:var(--color-typographic-link-s-font)}b,strong{font-weight:600}ul{list-style:square;margin-bottom:26px}ul li{margin-bottom:10px;padding:0 5px}p{line-height:26px;margin-bottom:26px}blockquote{font-style:italic;padding:0;text-align:center}figure{display:block;height:auto;width:100%}figcaption{color:var(--color-typographic-base-font);font-size:14px;font-style:italic;line-height:19.5px;margin-bottom:0;margin-top:6.5px;text-align:center}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:310px;padding:0 26px}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:var(--color-prism-background)}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83;cursor:help}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.Feed-module--feed--a6204 .Feed-module--item--c7a63{margin-bottom:32.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63:last-child{margin-bottom:13px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f{font-size:27px;line-height:39px;margin-bottom:13px;margin-top:0}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b{color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:hover{border-bottom:1px solid #242933;color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--description--57348{font-size:16px;line-height:26px;margin-bottom:19.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--time--72864{color:var(--color-typographic-base-font);font-size:14px;font-weight:600;text-transform:uppercase}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--divider--81a18{margin:0 13px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b{color:var(--color-secondary);font-size:14px;font-weight:600;text-transform:uppercase}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:hover{color:#5c92ff}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e{color:var(--color-primary);font-size:16px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:hover{border-bottom:1px solid #5c92ff;color:var(--color-primary)}.Layout-module--layout--2c933{margin-left:auto;margin-right:auto;max-width:1070px}.Layout-module--layout--2c933:before{content:"";display:table}.Layout-module--layout--2c933:after{clear:both;content:"";display:table}.Page-module--page--24e03{margin-bottom:52px}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:26px 19.5px 0}.Page-module--page--24e03 .Page-module--title--90338{font-size:40px;font-weight:600;line-height:52px;margin-bottom:37.7px;margin-top:0}.Page-module--page--24e03 .Page-module--body--561c4{font-size:16px;line-height:26px;margin:0 0 26px}@media screen and (min-width:685px){.Page-module--page--24e03{width:calc(58.275% - 12.5px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(12n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(12n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:32.5px 19.5px 0}}@media screen and (min-width:960px){.Page-module--page--24e03{width:calc(66.6% - 10px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(3n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(3n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:39px 26px 0}}.Pagination-module--pagination--d61cb{display:flex;margin-top:52px}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b{text-align:left;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:focus,.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8{text-align:right;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:focus,.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Button-module--button--b1113{border:1px solid var(--color-button-border);border-radius:20px;color:var(--color-button-color);display:inline-block;font-size:16px;font-weight:400;height:40px;line-height:40px;margin-left:auto;margin-right:auto;padding:0 26px;text-align:center;text-decoration:none}.Button-module--button--b1113:focus,.Button-module--button--b1113:hover{color:#5c92ff}.ThemeSwitcher-module--themeSwitcher--8a77f{--color:var(--color-theme-switcher)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b{align-items:center;background:transparent;border:0;cursor:pointer;display:flex;justify-content:center;outline:0}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b svg{stroke:var(--color);pointer-events:none;transition:stroke .4s}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b:hover{--color:var(--color-theme-switcher-hover)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--moon--10537{stroke-dasharray:0 1px;opacity:0;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--sun--2163a{stroke-dasharray:1px 1px;opacity:1;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--moon--10537{stroke-dasharray:1px 1px;opacity:1}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--sun--2163a{stroke-dasharray:0 1px;opacity:0}.Author-module--author--cbd31 .Author-module--photo--9787b{background-clip:padding-box;border-radius:50%;display:inline-block;height:75px;margin-bottom:0;width:75px}.Author-module--author--cbd31 .Author-module--photo--9787b img{border-radius:50%}.Author-module--author--cbd31 .Author-module--title--cf7e5{font-size:18px;font-weight:600;line-height:29.25px;margin:0}.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:focus,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:hover{color:var(--color-typographic-base-font)}.Author-module--author--cbd31 .Author-module--subtitle--86ec5{color:#7f8ba4;line-height:26px;margin-bottom:26px}.Author-module--author--cbd31 .Author-module--titleContainer--4f576{align-items:center;display:flex;justify-content:space-between;margin:13px 0}.Contacts-module--contacts--09178{margin-bottom:26px}.Contacts-module--contacts--09178 .Contacts-module--list--9670b{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;margin:13px 0;max-width:165px;padding:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0{align-content:center;align-items:center;border:1px solid var(--color-contacts-border);border-radius:50%;display:flex;height:40px;justify-content:center;line-height:40px;margin:6.5px;padding:0;text-align:center;width:40px}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0:nth-child(3n+1){margin-left:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0{border:0;color:var(--color-typographic-base-font);cursor:pointer;display:flex}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:focus,.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:hover{color:var(--color-typographic-link-p-font)}.Copyright-module--copyright--2c602{color:#7f8ba4;font-size:14px}.Menu-module--menu--113a9{margin-bottom:26px}.Menu-module--menu--113a9 .Menu-module--list--e1ae3{list-style:none;margin:0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679{margin:13px 0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02{border:0;color:var(--color-typographic-base-font);font-size:16px;font-weight:400}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:focus,.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:hover{border-bottom:1px solid #5c92ff;color:#5c92ff}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02.Menu-module--active--6cb74{border-bottom:1px solid var(--color-typographic-base-font);color:var(--color-typographic-base-font)}.Sidebar-module--sidebar--1bfa1{width:100%}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:26px 19.5px 0;position:relative}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{background:var(--color-sidebar-border);background:linear-gradient(to bottom,var(--color-sidebar-border) 0,var(--color-sidebar-border) 48%,var(--color-sidebar-border-fade) 100%)}@media screen and (min-width:685px){.Sidebar-module--sidebar--1bfa1{width:calc(41.625% - 17.5px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:32.5px 19.5px 0}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{bottom:0;content:"";height:540px;position:absolute;right:-10px;top:30px;width:1px}}@media screen and (min-width:960px){.Sidebar-module--sidebar--1bfa1{width:calc(33.3% - 20px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:39px}}.Author-module--author--1c58d{border-top:1px solid var(--color-page-border);line-height:26px;margin-bottom:52px;margin-top:26px;max-width:640px;padding-top:26px}.Author-module--author--1c58d .Author-module--bio--08950 .Author-module--twitter--90647{display:block;text-decoration:underline}.Author-module--author--1c58d .Author-module--bio--08950 .Author-module--twitter--90647:focus,.Author-module--author--1c58d .Author-module--bio--08950 .Author-module--twitter--90647:hover{color:var(--color-typographic-link-s-font)}@media screen and (min-width:685px){.Author-module--author--1c58d{margin-left:auto;margin-right:auto}}.Content-module--content--80d58{margin:0 auto;max-width:945px;padding:0 13px}.Content-module--content--80d58 .Content-module--title--09504{font-size:32px;font-weight:600;line-height:42.9px;margin:26px auto 0;max-width:640px;text-align:center}.Content-module--content--80d58 .Content-module--body--726c2 figure{margin-bottom:26px}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote{font-style:italic;margin-top:0;padding:26px 0;text-align:center}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote p{font-size:26.9072px;line-height:39px;margin-bottom:26px;margin-top:0;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 a{text-decoration:underline}.Content-module--content--80d58 .Content-module--body--726c2 *{margin-left:auto;margin-right:auto;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{visibility:hidden}.Content-module--content--80d58 .Content-module--body--726c2 h2>a>svg{fill:var(--color-typographic-base-font)}.Content-module--content--80d58 .Content-module--body--726c2 img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--80d58{padding:0}.Content-module--content--80d58 .Content-module--title--09504{font-size:48px;line-height:58.5px;margin-bottom:39px;margin-top:58.5px}.Content-module--content--80d58 .Content-module--body--726c2,.Content-module--content--80d58 .Content-module--body--726c2 p{font-size:18px;line-height:29.25px;margin-bottom:29.25px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{padding-right:13px;visibility:unset}}.Meta-module--meta--dae0a .Meta-module--date--4d30d{font-style:italic}.Tags-module--tags--18589{margin-bottom:13px}.Tags-module--tags--18589 .Tags-module--list--82ae6{list-style:none;padding:0}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015{display:inline-block;margin:6.5px 0}@media screen and (min-width:685px){.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015:first-child{margin-left:0;padding-left:0}}.Post-module--post--3a994 .Post-module--content--3c6e5{margin:0 auto}.Post-module--post--3a994 .Post-module--comments--d3b99,.Post-module--post--3a994 .Post-module--footer--f8705{margin:0 auto;max-width:640px;padding:0 13px}.Post-module--post--3a994 .Post-module--buttons--2972d{align-items:center;display:flex;justify-content:center;margin:26px 0 0;text-align:center}.Post-module--post--3a994 .Post-module--buttons--2972d .Post-module--buttonArticles--d793a{margin:0 13px 0 0}@media screen and (min-width:960px){.Post-module--post--3a994 .Post-module--comments--d3b99,.Post-module--post--3a994 .Post-module--footer--f8705{padding:0}.Post-module--post--3a994 .Post-module--buttons--2972d{left:30px;margin:0 13px 0 0;max-width:none;position:fixed;top:30px}}</style><title data-gatsby-head="true">typeorm getMany(), getRawMany() - 개발 블로그</title><link rel="alternate" type="application/rss+xml" title="개발 블로그" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-73379983-2"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-73379983-2', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=f5f450b21c66d237cc653131e0e9826a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=f5f450b21c66d237cc653131e0e9826a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=f5f450b21c66d237cc653131e0e9826a"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><script>
          void function() {
            var cachedMode;

            try {
              var preferredTheme = JSON.parse(localStorage.getItem('diesel:theme-atom'));

              if (preferredTheme && preferredTheme.mode) {
                cachedMode = preferredTheme.mode;
              }
            } catch (err) { }

            function setTheme(newTheme) {
              document.documentElement.className = newTheme;
            }

            var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

            setTheme(cachedMode || (darkQuery.matches ? 'dark' : 'light'));
          }()
        </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--2c933"><div class="Post-module--post--3a994"><div class="Post-module--buttons--2972d"><a class="Button-module--button--b1113 Post-module--buttonArticles--d793a" href="/">All Articles</a></div><div class="Post-module--content--3c6e5"><div class="Content-module--content--80d58"><h1 class="Content-module--title--09504">typeorm getMany(), getRawMany()</h1><div class="Content-module--body--726c2"><p>쿼리빌더를 사용할 때 쓰게되는 getMany()와 getRawMany()
이 둘의 차이를 알아보자.</p>
<p>우선 getMany()를 타고 들어가보면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Entity<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>
    Gets entities returned by execution <span class="token keyword">of</span> generated query builder sql<span class="token punctuation">.</span></code></pre></div>
<p>위처럼 실행된 쿼리빌더의 sql에서 반환된 엔티티를 가져온다고 되어있다.</p>
<p>소스코드를 보면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">async</span> <span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Entity<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"optimistic"</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockCanNotBeUsedError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRawAndEntities</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results<span class="token punctuation">.</span>entities
    <span class="token punctuation">}</span></code></pre></div>
<p>getMany는 getRawAndEntities 메서드를 통해 가져온 값에서 엔티티를 반환하는 것을 알 수 있다.</p>
<p>여기서 getRawAndEntities를 보면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">async</span> <span class="token generic-function"><span class="token function">getRawAndEntities</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">{</span>
        entities<span class="token operator">:</span> Entity<span class="token punctuation">[</span><span class="token punctuation">]</span>
        raw<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> queryRunner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainQueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> transactionStartedByUs<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// start transaction if it was enabled</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>useTransaction <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span>
                queryRunner<span class="token punctuation">.</span>isTransactionActive <span class="token operator">===</span> <span class="token boolean">false</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">startTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                transactionStartedByUs <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>queryEntity <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeEntitiesAndRawResults</span><span class="token punctuation">(</span>queryRunner<span class="token punctuation">)</span>

            <span class="token comment">// close transaction if we started it</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionStartedByUs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> results
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// rollback transaction if we started it</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionStartedByUs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">rollbackTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>rollbackError<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> error
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>queryRunner <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queryRunner<span class="token punctuation">)</span>
                <span class="token comment">// means we created our own query runner</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>쿼리빌더에서 생성된 sql을 실행하고 <code class="language-text">executeEntitiesAndRawResults()</code>에서의 반환값을 리턴하는 것을 알 수 있다.</p>
<p><code class="language-text">executeEntitiesAndRawResults()</code>로 들어가보자</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token function">executeEntitiesAndRawResults</span><span class="token punctuation">(</span>
        queryRunner<span class="token operator">:</span> QueryRunner<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> entities<span class="token operator">:</span> Entity<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> raw<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeORMError</span><span class="token punctuation">(</span>
                <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Alias is not set. Use "from" method to set an alias.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"pessimistic_read"</span> <span class="token operator">||</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"pessimistic_write"</span> <span class="token operator">||</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"pessimistic_partial_write"</span> <span class="token operator">||</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"pessimistic_write_or_fail"</span> <span class="token operator">||</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"for_no_key_update"</span> <span class="token operator">||</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"for_key_share"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token operator">!</span>queryRunner<span class="token punctuation">.</span>isTransactionActive
        <span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PessimisticLockTransactionRequiredError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"optimistic"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">.</span>metadata
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>metadata<span class="token punctuation">.</span>versionColumn <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>metadata<span class="token punctuation">.</span>updateDateColumn<span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoVersionOrUpdateDateColumnError</span><span class="token punctuation">(</span>metadata<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> relationIdLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelationIdLoader</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">,</span>
            queryRunner<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>relationIdAttributes<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">const</span> relationCountLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelationCountLoader</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">,</span>
            queryRunner<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>relationCountAttributes<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">const</span> relationIdMetadataTransformer <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">RelationIdMetadataToAttributeTransformer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">)</span>
        relationIdMetadataTransformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> relationCountMetadataTransformer <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">RelationCountMetadataToAttributeTransformer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">)</span>
        relationCountMetadataTransformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> rawResults<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            entities<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment">// for pagination enabled (e.g. skip and take) its much more complicated - its a special process</span>
        <span class="token comment">// where we make two queries to find the data we need</span>
        <span class="token comment">// first query find ids in skip and take range</span>
        <span class="token comment">// and second query loads the actual data in given ids range</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>skip <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>take<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>joinAttributes<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// we are skipping order by here because its not working in subqueries anyway</span>
            <span class="token comment">// to make order by working we need to apply it on a distinct query</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span>selects<span class="token punctuation">,</span> orderBys<span class="token punctuation">]</span> <span class="token operator">=</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createOrderByCombinedWithSelectExpression</span><span class="token punctuation">(</span><span class="token string">"distinctAlias"</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">.</span>metadata
            <span class="token keyword">const</span> mainAliasName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">.</span>name

            <span class="token keyword">const</span> querySelects <span class="token operator">=</span> metadata<span class="token punctuation">.</span>primaryColumns<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span>primaryColumn<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> distinctAlias <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span><span class="token string">"distinctAlias"</span><span class="token punctuation">)</span>
                    <span class="token keyword">const</span> columnAlias <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span>
                        DriverUtils<span class="token punctuation">.</span><span class="token function">buildAlias</span><span class="token punctuation">(</span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span>driver<span class="token punctuation">,</span>
                            <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                            mainAliasName<span class="token punctuation">,</span>
                            primaryColumn<span class="token punctuation">.</span>databaseName<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>orderBys<span class="token punctuation">[</span>columnAlias<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token comment">// make sure we aren't overriding user-defined order in inverse direction</span>
                        orderBys<span class="token punctuation">[</span>columnAlias<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"ASC"</span>

                    <span class="token keyword">const</span> alias <span class="token operator">=</span> DriverUtils<span class="token punctuation">.</span><span class="token function">buildAlias</span><span class="token punctuation">(</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span>driver<span class="token punctuation">,</span>
                        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                        <span class="token string">"ids_"</span> <span class="token operator">+</span> mainAliasName<span class="token punctuation">,</span>
                        primaryColumn<span class="token punctuation">.</span>databaseName<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>

                    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>distinctAlias<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>columnAlias<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> AS </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span>
                        alias<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>

            <span class="token keyword">const</span> originalQuery <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment">// preserve original timeTravel value since we set it to "false" in subquery</span>
            <span class="token keyword">const</span> originalQueryTimeTravel <span class="token operator">=</span>
                originalQuery<span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>timeTravel

            rawResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">SelectQueryBuilder</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">,</span>
                queryRunner<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DISTINCT </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>querySelects<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addSelect</span><span class="token punctuation">(</span>selects<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
                    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originalQuery
                        <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">timeTravelQuery</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// set it to "false" since time travel clause must appear at the very end and applies to the entire SELECT clause.</span>
                        <span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                    <span class="token string">"distinctAlias"</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">timeTravelQuery</span><span class="token punctuation">(</span>originalQueryTimeTravel<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>skip<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>take<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>orderBys<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>cache <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>cacheId
                        <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>cacheId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-pagination</span><span class="token template-punctuation string">`</span></span>
                        <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>cache<span class="token punctuation">,</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>cacheDuration<span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setNativeParameters</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>nativeParameters<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getRawMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>rawResults<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> condition <span class="token operator">=</span> <span class="token string">""</span>
                <span class="token keyword">const</span> parameters<span class="token operator">:</span> ObjectLiteral <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>metadata<span class="token punctuation">.</span>hasMultiplePrimaryKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    condition <span class="token operator">=</span> rawResults
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> metadata<span class="token punctuation">.</span>primaryColumns
                                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>primaryColumn<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                    <span class="token keyword">const</span> paramKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">orm_distinct_ids_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>primaryColumn<span class="token punctuation">.</span>databaseName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                                    <span class="token keyword">const</span> paramKeyResult <span class="token operator">=</span>
                                        DriverUtils<span class="token punctuation">.</span><span class="token function">buildAlias</span><span class="token punctuation">(</span>
                                            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span>driver<span class="token punctuation">,</span>
                                            <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                                            <span class="token string">"ids_"</span> <span class="token operator">+</span> mainAliasName<span class="token punctuation">,</span>
                                            primaryColumn<span class="token punctuation">.</span>databaseName<span class="token punctuation">,</span>
                                        <span class="token punctuation">)</span>
                                    parameters<span class="token punctuation">[</span>paramKey<span class="token punctuation">]</span> <span class="token operator">=</span>
                                        result<span class="token punctuation">[</span>paramKeyResult<span class="token punctuation">]</span>
                                    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mainAliasName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>primaryColumn<span class="token punctuation">.</span>propertyPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paramKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" AND "</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" OR "</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> alias <span class="token operator">=</span> DriverUtils<span class="token punctuation">.</span><span class="token function">buildAlias</span><span class="token punctuation">(</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span>driver<span class="token punctuation">,</span>
                        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                        <span class="token string">"ids_"</span> <span class="token operator">+</span> mainAliasName<span class="token punctuation">,</span>
                        metadata<span class="token punctuation">.</span>primaryColumns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>databaseName<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>

                    <span class="token keyword">const</span> ids <span class="token operator">=</span> rawResults<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=></span> result<span class="token punctuation">[</span>alias<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">const</span> areAllNumbers <span class="token operator">=</span> ids<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>
                        <span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">typeof</span> id <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>areAllNumbers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// fixes #190. if all numbers then its safe to perform query without parameter</span>
                        condition <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mainAliasName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
                            metadata<span class="token punctuation">.</span>primaryColumns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>propertyPath
                        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> IN (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ids<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        parameters<span class="token punctuation">[</span><span class="token string">"orm_distinct_ids"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ids
                        condition <span class="token operator">=</span>
                            mainAliasName <span class="token operator">+</span>
                            <span class="token string">"."</span> <span class="token operator">+</span>
                            metadata<span class="token punctuation">.</span>primaryColumns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>propertyPath <span class="token operator">+</span>
                            <span class="token string">" IN (:...orm_distinct_ids)"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                rawResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">mergeExpressionMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        extraAppendedAndWhereCondition<span class="token operator">:</span> condition<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">loadRawResults</span><span class="token punctuation">(</span>queryRunner<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            rawResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadRawResults</span><span class="token punctuation">(</span>queryRunner<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>rawResults<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// transform raw results into entities</span>
            <span class="token keyword">const</span> rawRelationIdResults <span class="token operator">=</span> <span class="token keyword">await</span> relationIdLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>rawResults<span class="token punctuation">)</span>
            <span class="token keyword">const</span> rawRelationCountResults <span class="token operator">=</span> <span class="token keyword">await</span> relationCountLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
                rawResults<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            <span class="token keyword">const</span> transformer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSqlResultsToEntityTransformer</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span>driver<span class="token punctuation">,</span>
                rawRelationIdResults<span class="token punctuation">,</span>
                rawRelationCountResults<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>queryRunner<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            entities <span class="token operator">=</span> transformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>
                rawResults<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token operator">!</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>

            <span class="token comment">// broadcast all "after load" events</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>callListeners <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">.</span>hasMetadata
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span>broadcaster<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>
                    <span class="token string">"Load"</span><span class="token punctuation">,</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>mainAlias<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
                    entities<span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>relationLoadStrategy <span class="token operator">===</span> <span class="token string">"query"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> queryStrategyRelationIdLoader <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryStrategyRelationIdLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">,</span> queryRunner<span class="token punctuation">)</span>

            <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>relationMetadatas<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>relation<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> relationTarget <span class="token operator">=</span> relation<span class="token punctuation">.</span>inverseEntityMetadata<span class="token punctuation">.</span>target
                    <span class="token keyword">const</span> relationAlias <span class="token operator">=</span>
                        relation<span class="token punctuation">.</span>inverseEntityMetadata<span class="token punctuation">.</span>targetName

                    <span class="token keyword">const</span> select <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>select<span class="token punctuation">)</span>
                        <span class="token operator">?</span> OrmUtils<span class="token punctuation">.</span><span class="token function">propertyPathsToTruthyObject</span><span class="token punctuation">(</span>
                              <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>select <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span>
                        <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>select
                    <span class="token keyword">const</span> relations <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>relations<span class="token punctuation">)</span>
                        <span class="token operator">?</span> OrmUtils<span class="token punctuation">.</span><span class="token function">propertyPathsToTruthyObject</span><span class="token punctuation">(</span>
                              <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>relations<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span>
                        <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>relations

                    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span>queryRunner<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>relationAlias<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>relationTarget<span class="token punctuation">,</span> relationAlias<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setFindOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            select<span class="token operator">:</span> select
                                <span class="token operator">?</span> OrmUtils<span class="token punctuation">.</span><span class="token function">deepValue</span><span class="token punctuation">(</span>
                                      select<span class="token punctuation">,</span>
                                      relation<span class="token punctuation">.</span>propertyPath<span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span>
                                <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                            order<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>order
                                <span class="token operator">?</span> OrmUtils<span class="token punctuation">.</span><span class="token function">deepValue</span><span class="token punctuation">(</span>
                                      <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>order<span class="token punctuation">,</span>
                                      relation<span class="token punctuation">.</span>propertyPath<span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span>
                                <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                            relations<span class="token operator">:</span> relations
                                <span class="token operator">?</span> OrmUtils<span class="token punctuation">.</span><span class="token function">deepValue</span><span class="token punctuation">(</span>
                                      relations<span class="token punctuation">,</span>
                                      relation<span class="token punctuation">.</span>propertyPath<span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span>
                                <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                            withDeleted<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>withDeleted<span class="token punctuation">,</span>
                            relationLoadStrategy<span class="token operator">:</span>
                                <span class="token keyword">this</span><span class="token punctuation">.</span>findOptions<span class="token punctuation">.</span>relationLoadStrategy<span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>entities<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> relatedEntityGroups<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
                            <span class="token keyword">await</span> queryStrategyRelationIdLoader<span class="token punctuation">.</span><span class="token function">loadManyToManyRelationIdsAndGroup</span><span class="token punctuation">(</span>
                                relation<span class="token punctuation">,</span>
                                entities<span class="token punctuation">,</span>
                                <span class="token keyword">undefined</span><span class="token punctuation">,</span>
                                queryBuilder<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span>
                        entities<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                            <span class="token keyword">const</span> relatedEntityGroup <span class="token operator">=</span> relatedEntityGroups<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
                                <span class="token punctuation">(</span>group<span class="token punctuation">)</span> <span class="token operator">=></span> group<span class="token punctuation">.</span>entity <span class="token operator">===</span> entity<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>relatedEntityGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">const</span> value <span class="token operator">=</span>
                                    relatedEntityGroup<span class="token punctuation">.</span>related <span class="token operator">===</span> <span class="token keyword">undefined</span>
                                        <span class="token operator">?</span> <span class="token keyword">null</span>
                                        <span class="token operator">:</span> relatedEntityGroup<span class="token punctuation">.</span>related
                                relation<span class="token punctuation">.</span><span class="token function">setEntityValue</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            raw<span class="token operator">:</span> rawResults<span class="token punctuation">,</span>
            entities<span class="token operator">:</span> entities<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>굉장히 긴 코드가 나온다.</p>
<p>위 코드는 우선 lock에 대한 예외처리가 되어 있고, <code class="language-text">loadRawResults</code>에서 원시결과를 가져오는 것을 알 수 있다.
그리고 가져온 원시결과를 <code class="language-text">RawSqlResultsToEntityTransformer</code>클래스를 통해 엔티티로 변환하는 작업을 수행한다.
마지막에는 관계에 따른 로딩에 관련된 내용이 나오고,
원시결과와 엔티티를 반환하는 것을 알 수 있다.
위를 통해 원시데이터를 가져와 엔티티화 시키는 것을 알 수 있었다.</p>
<p>그럼 원시결과가 아닌 엔티티를 반환하는 <code class="language-text">getMany()</code>에서의 특징은 무엇이 있을까?</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serviceRepository
  <span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">,</span> <span class="token string">"mapper"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string">"service.categoryMapper"</span><span class="token punctuation">,</span> <span class="token string">"mapper"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"service.status = :status"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">"Applying"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>위 코드는 service 테이블에서 mapper 테이블을 조인한 코드이다.
<code class="language-text">select</code>를 하지 않으면 조인을 했어도 기존(service) 엔티티만을 반환한다.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// 결과값</span>
<span class="token comment">// [</span>
<span class="token comment">//   {...service entity, ...mapper entity}...</span>
<span class="token comment">// ]</span></code></pre></div>
<p>위의 결과를 받을 수 있다.</p>
<p>여기서 추가적으로 mapper entity에서의 일부 값을 가져온다고 했을 때
즉, <code class="language-text">select('service','mapper.maincategoryid')</code> 이런식으로 가져오게 된다면
결과값에서 mapper entity 는 {maincategoryid : xx}가 될 것이다.</p>
<p>여기서 mapper entity의 다른 값에 접근을 하게 된다면 undefined가 나오게 된다.</p>
<p>이제 <code class="language-text">getRawMany()</code>를 봐보면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/**
     * Gets all raw results returned by execution of generated query builder sql.
     */</span>
    <span class="token generic-function"><span class="token function">getRawMany</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">getMany</code>와 다르게 엔티티가 아닌 raw results 즉 원시결과를 가져오는 메서드이다.</p>
<p>소스코드를 보면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">async</span> <span class="token generic-function"><span class="token function">getRawMany</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>lockMode <span class="token operator">===</span> <span class="token string">"optimistic"</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockCanNotBeUsedError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>queryEntity <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">const</span> queryRunner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainQueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> transactionStartedByUs<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// start transaction if it was enabled</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>expressionMap<span class="token punctuation">.</span>useTransaction <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span>
                queryRunner<span class="token punctuation">.</span>isTransactionActive <span class="token operator">===</span> <span class="token boolean">false</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">startTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                transactionStartedByUs <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadRawResults</span><span class="token punctuation">(</span>queryRunner<span class="token punctuation">)</span>

            <span class="token comment">// close transaction if we started it</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionStartedByUs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> results
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// rollback transaction if we started it</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionStartedByUs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">rollbackTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>rollbackError<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> error
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>queryRunner <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queryRunner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// means we created our own query runner</span>
                <span class="token keyword">await</span> queryRunner<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>트랜잭션으로 <code class="language-text">loadRawResults</code>가 감싸져 있고 <code class="language-text">loadRawResults</code>를 통해 가져온 원시결과를 반환하는 것을 알 수 있다.
<code class="language-text">loadRawResults</code>는 원시 결과를 가져오는 메서드이므로 <code class="language-text">getRawMany</code>는 쿼리 결과를 순수한 JSON 객체의 배열로 반환한다.</p>
<p>원시결과를 반환하는 <code class="language-text">getRawMany</code>에는 어떤 특징이 있을까?</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serviceRepository
  <span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">,</span> <span class="token string">"mapper"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string">"service.categoryMapper"</span><span class="token punctuation">,</span> <span class="token string">"mapper"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"service.status = :status"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">"Applying"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getRawMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>아까와 같은 service entity에서 mapper entity를 조인한 결과를 가져오는 쿼리빌더이다.
<code class="language-text">getRawMany</code>는 JSON 객체이기 때문에 반환값에 각각의 alias가 붙어있다.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">{</span>
  service_xx<span class="token punctuation">,</span>
  service_xxx<span class="token punctuation">,</span>
  mapper_xx<span class="token punctuation">,</span>
  mapper_xxx<span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">getMany</code>와 다른 점은 엔티티화 되어 있지 않기 때문에 조인한 테이블도 위처럼 하나의 객체안에 들어있고,
원시결과이기 때문에 공식문서에도 나와 있듯이 데이터를 통한 합계를 내거나 하는 작업을 할 수 있다.
But sometimes you need to select some specific data, let’s say the sum of all user photos. This data is not an entity, it’s called raw data. To get raw data, you use getRawOne and getRawMany.
예를 들자면</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">ex<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"AVG(table.int) as avgStarPoint"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">select</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">IF(조건 IS NOT NULL, true, false) AS alias</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"SUM(user.photosCount)"</span><span class="token punctuation">,</span> <span class="token string">"sum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>이러한 작업들을 할 수 있다고 볼 수 있다.</p>
<p>또한 <code class="language-text">getRawMany</code>를 사용 할 때 <code class="language-text">select('entity.*')</code>을 사용하면
entity_xx 이렇게 나오는 것을 xx 이렇게 나오게 할 수 있다.</p>
<p>그리고 원시결과에 접근하는 <code class="language-text">getRawMany</code>는 결과값을 잘라낼 때 (ex . 페이지네이션)
skip, take가 아니라 offset, limit을 사용해야 한다.
skip과 take를 사용하면 적용이 되지 않아 전체가 나오는 것을 볼 수 있다.</p>
<p>순수하게 엔티티만 반환하는 api에서는 <code class="language-text">getMany</code>가 보다 더 깔끔하게 보여줄 수 있고,
순수한 데이터가 필요한 경우거나 특정 열만 선택하는 경우 <code class="language-text">getRawMany</code>가 보다 유용하다.</p></div></div></div><div class="Post-module--footer--f8705"><div class="Meta-module--meta--dae0a"><p class="Meta-module--date--4d30d">Published<!-- --> <!-- -->Oct 11, 2023</p></div><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113" href="/tag/typeorm/">typeorm</a></li></ul></div><div class="Author-module--author--1c58d"><p class="Author-module--bio--08950">안녕하세요 백엔드 개발자 김정현입니다.</p></div></div><div class="Post-module--comments--d3b99"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2023-10-10---typeorm getMany(), getRawMany()/";window.___webpackCompilationHash="5989df9b1ae04715a7c6";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ea23f7c23d89cf7d68b1.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-0c915c7b1bdb5eac4fdf.js"],"component---src-templates-categories-template-categories-template-tsx":["/component---src-templates-categories-template-categories-template-tsx-d33363d8e00b599cdd70.js"],"component---src-templates-category-template-category-template-tsx":["/component---src-templates-category-template-category-template-tsx-eea6004a8c6883cd624b.js"],"component---src-templates-index-template-index-template-tsx":["/component---src-templates-index-template-index-template-tsx-994e2436754c8dcd8fb3.js"],"component---src-templates-not-found-template-not-found-template-tsx":["/component---src-templates-not-found-template-not-found-template-tsx-35610fbcc7ba1428b73e.js"],"component---src-templates-page-template-page-template-tsx":["/component---src-templates-page-template-page-template-tsx-275ab40f7883f7546251.js"],"component---src-templates-post-template-post-template-tsx":["/component---src-templates-post-template-post-template-tsx-bf90fd12336a195c4980.js"],"component---src-templates-tag-template-tag-template-tsx":["/component---src-templates-tag-template-tag-template-tsx-d1d51b16d9bb559e91c9.js"],"component---src-templates-tags-template-tags-template-tsx":["/component---src-templates-tags-template-tags-template-tsx-f390754b642ae2999151.js"]};/*]]>*/</script><script src="/app-ea23f7c23d89cf7d68b1.js" async=""></script><script src="/framework-745d5d28c0250a1a333b.js" async=""></script><script src="/webpack-runtime-ca4bd3067d940c6ed0ad.js" async=""></script></body></html>